<!doctype html>
<html lang="fr">
    <head>
        <meta charset="utf-8">
        <title>TEST</title>
        <link rel="stylesheet" href="css/style.css">
    </head>
    <body>
        <div class="center-content">
            <h2>QUI ES-TU ?</h2>
            <form id="who" method="GET">
                <input type="text" id="name">
                <input type="submit">
            </form>
        </div>
    </body>

    <script src="https://cdn.jsdelivr.net/npm/gun/gun.js"></script>

    <script src="js/utils.js"></script>
    <script>
        localStorage['dungeon-gun-url'] = "http://localhost:8080/gun";

        initGun();

        if (localStorage['dungeon-userId']) {
            gun.get("users").get(localStorage['dungeon-userId']).val(data => {
                if (data) {
                    window.location.href = "./menu.html";
                }
            });
        }

        document.querySelector("#who").addEventListener("submit", function(e){
            e.preventDefault();
            var name = document.getElementById("name").value;
            if (name) {
                var newUser;
                new Promise(resolve => {
                    newUser = gun.get("users").set({name: name}, () => {
                        resolve();
                    });
                }).then(() => {
                    newUser.val(data => {
                        localStorage['dungeon-userId'] = data._["#"];
                        window.location.href = "./menu.html";
                    });
                });
            }
        });

    </script>
</html>