<!doctype html>
<html lang="fr">
    <head>
        <meta charset="utf-8">
        <title>TEST</title>
        <link rel="stylesheet" href="css/style.css">
        <link rel="stylesheet" href="css/game.css">
    </head>
    <body>
        <div class="center-content">
            <h2 id="name"></h2>
            <div id="list" class="div-group">
            </div>
            <form id="addPlayer">
                <input type="text" id="playerName">
                <input type="submit" value="AJOUTER">
            </form>
        </div>
    </body>

    <script src="https://cdn.jsdelivr.net/npm/gun/gun.js"></script>

    <script src="js/utils.js"></script>
    <script src="js/game.js"></script>
    <script>
        initGun();

        var user;
        var game;
        var players = [];

        getUser().then(usr => {
            user = usr;
            game = user.get("game");
            game.get("name").val(name =>
                document.getElementById("name").innerText = name);
            game.get("players").map().on((player, id) => {
                if (players[id] === undefined) {
                    players[id] = player;
                    var elt = document.createElement("div");
                    elt.innerHTML = player.name;
                    document.getElementById("list").appendChild(elt);
                }
            });
        });

        document.querySelector("#addPlayer")
        .addEventListener("submit", function(e) {
            e.preventDefault();
            var playerName = document.getElementById("playerName").value;
            document.getElementById("playerName").value = "";
            initPlayer(playerName).then(player => {
                player.put({userId: localStorage["dungeon-userId"]});
                game.get("players").set(player);
            });
        });

    </script>
</html>